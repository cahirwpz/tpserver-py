#!/usr/bin/env python

import sys

sys.path.insert(0, '.')
sys.path.insert(0, 'tests')
sys.path.insert(0, 'libtpproto2-py')

from twisted.internet import reactor

from tp.server.logging import Logger, LoggerConfiguration
from tp.server.configuration import CLIConfigurator, ConfigurationError

from testrunner import TestRunner, TestRunnerConfiguration

def main():
	logger = Logger()
	runner = TestRunner()

	configurator = CLIConfigurator( "Thousand Parsec Test Client" )
	configurator.registerComponent( logger, LoggerConfiguration() )
	configurator.registerComponent( runner, TestRunnerConfiguration() )

	try:
		configurator.configParse()
		configurator.configCommit()
	except ConfigurationError, ex:
		configurator.help()

		raise SystemExit( '\033[31;1mConfiguration error:\033[0m %s' % ex )

	logger.start()
	runner.start()
	reactor.run()

if __name__ == '__main__':
	main()
